<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">彻底终结 MySQL 乱码问题 | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tudouPotatoo.github.io/my-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tudouPotatoo.github.io/my-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="彻底终结 MySQL 乱码问题 | My Site"><meta data-rh="true" name="description" content="让我带你们彻底终结MySQL乱码问题"><meta data-rh="true" property="og:description" content="让我带你们彻底终结MySQL乱码问题"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-02-09T05:11:00.913Z"><meta data-rh="true" property="article:author" content="https://github.com/tudouPotatoo"><meta data-rh="true" property="article:tag" content="MySQL,数据库,字符集,Docker"><link data-rh="true" rel="icon" href="/my-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery"><link data-rh="true" rel="alternate" href="https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery","mainEntityOfPage":"https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery","url":"https://tudouPotatoo.github.io/my-blog/blog/mysql-encoding-mastery","headline":"彻底终结 MySQL 乱码问题","name":"彻底终结 MySQL 乱码问题","description":"让我带你们彻底终结MySQL乱码问题","datePublished":"2026-02-09T05:11:00.913Z","author":{"@type":"Person","name":"tudouPotatoo","description":"software engineer","url":"https://github.com/tudouPotatoo","image":"https://github.com/tudouPotatoo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://tudouPotatoo.github.io/my-blog/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/my-blog/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-blog/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/my-blog/assets/css/styles.9072f9ea.css">
<script src="/my-blog/assets/js/runtime~main.534641a9.js" defer="defer"></script>
<script src="/my-blog/assets/js/main.ceb23698.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/my-blog/img/logo.svg"><link rel="preload" as="image" href="https://github.com/tudouPotatoo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-blog/"><div class="navbar__logo"><img src="/my-blog/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/my-blog/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/my-blog/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/my-blog/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/my-blog/blog/mysql-encoding-mastery">彻底终结 MySQL 乱码问题</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-blog/blog/welcome">Welcome</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-blog/blog/mdx-blog-post">MDX Blog Post</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2019</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-blog/blog/long-blog-post">Long Blog Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-blog/blog/first-blog-post">First Blog Post</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">彻底终结 MySQL 乱码问题</h1><div class="container_mt6G margin-vert--md"><time datetime="2026-02-09T05:11:00.913Z">2026年2月9日</time> · <!-- -->阅读需 30 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/my-blog/blog/authors/tudou-potatoo"><img class="avatar__photo authorImage_XqGP" src="https://github.com/tudouPotatoo.png" alt="tudouPotatoo"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/my-blog/blog/authors/tudou-potatoo"><span class="authorName_yefp" translate="no">tudouPotatoo</span></a></div><small class="authorTitle_nd0D" title="software engineer">software engineer</small><div class="authorSocials_rSDt"><a href="https://x.com/sebastienlorber" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://www.linkedin.com/in/sebastienlorber/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" style="--dark:#0a66c2;--light:#ffffffe6" class="authorSocialIcon_XYv3 linkedinSvg_FCgI"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"></path></svg></a><a href="https://github.com/tudouPotatoo" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://thisweekinreact.com" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="newsletter"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="authorSocialIcon_XYv3"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M1.2 12a10.8 10.8 0 1 0 21.6 0a10.8 10.8 0 0 0 -21.6 0"></path><path d="M1.92 8.4h20.16"></path><path d="M1.92 15.6h20.16"></path><path d="M11.4 1.2a20.4 20.4 0 0 0 0 21.6"></path><path d="M12.6 1.2a20.4 20.4 0 0 1 0 21.6"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>让我带你们彻底终结MySQL乱码问题</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="一背景">一、背景<a href="#一背景" class="hash-link" aria-label="一、背景的直接链接" title="一、背景的直接链接" translate="no">​</a></h2>
<p>最近在学习一个新项目，部署过程中涉及到 MySQL 数据库的初始化。项目作者已经提供了完整的 DDL（表结构）和 DML（初始数据）脚本。按照常规逻辑，我只需要在 Docker 中启动 MySQL 容器，创建好数据库，直接导入这些 <code>.sql</code> 文件即可。</p>
<p>然而，在看似顺理成章的操作后，我遇到了一个令人头大的问题：<strong>数据库中的中文内容全部变成了乱码。</strong></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="二操作复现">二、操作复现<a href="#二操作复现" class="hash-link" aria-label="二、操作复现的直接链接" title="二、操作复现的直接链接" translate="no">​</a></h2>
<p>为了准确定位问题，我复盘了当时的操作流程：</p>
<ol>
<li class="">
<p>启动MySQL容器</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name mysql \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--platform=linux/amd64 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p 3306:3306 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e MYSQL_ROOT_HOST=&#x27;%&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e MYSQL_ROOT_PASSWORD=root \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-d amd64/mysql:5.7.36</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>创建数据库</p>
<p>在terminal执行该命令，进入mysql的交互界面</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it mysql mysql -uroot -p</span><br></span></code></pre></div></div>
<p>手动创建一个名为 <code>12306</code> 的数据库，并指定字符集为 <code>utf8mb4</code>：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!32312 IF NOT EXISTS*/</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>导入 SQL 脚本</p>
<p>注意：由于如果我直接在mysql交互界面执行，还需要先将我电脑上的.sql文件cp到docker容器内，我觉得比较麻烦，所以我就重新开了一个terminal，执行下面这个命令，这样就不涉及文件的复制了。</p>
<p>执行DDL语句</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -i mysql-Docker mysql -u root -p 12306 &lt; /Users/tudouPotatoo/Developer/JavaCode/12306/resources/db/12306-springboot.sql;</span><br></span></code></pre></div></div>
<p>执行DML语句</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -i mysql mysql -u root -proot --default-character-set=utf8mb4 12306 &lt; /Users/tudouPotatoo/Developer/JavaCode/12306/resources/data/12306-springboot.sql;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>到这里，我们的数据库建好了，表中的数据也插进去了。</p>
<p>原本以为大功告成，但当我查看表数据时发现，原本 <code>.sql</code> 文件中清晰的中文内容，在数据库中全都变成了类似 <code>äéå±±</code> 的乱码（如下图所示）。</p>
<p><img decoding="async" loading="lazy" alt="image-20260209163719072" src="/my-blog/assets/images/image-20260209163719072-487d1324e19cf15ca67514f3f8c6c0a8.png" width="1410" height="538" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="image-20260209163556048" src="/my-blog/assets/images/image-20260209163556048-b9f533d9eaab27ea8dcbb999a7618842.png" width="1572" height="350" class="img_ev3q"></p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="三深度探究乱码背后的真相">三、深度探究：乱码背后的真相<a href="#三深度探究乱码背后的真相" class="hash-link" aria-label="三、深度探究：乱码背后的真相的直接链接" title="三、深度探究：乱码背后的真相的直接链接" translate="no">​</a></h2>
<blockquote>
<p>感觉非常懵，这个时候想起来看《MySQL是怎样运行的》其中一章是讲乱码的，过了一段时间已经忘的差不多了，但是翻翻笔记，能想起个大概，突然感觉之前看的一些东西，总结的一些东西并不是没用的。当然遇到了问题，再回去翻笔记，从而解决问题，又会对之前的知识有新的理解。</p>
<p>感觉学东西的时候，不要求自己能够完全记住，只要能够完全理解就可以了。以后遇到了相关的问题，翻资料能够马上找到问题的本质然后去解决。</p>
<p>背是没有必要的，没有人能比大模型记得得更多，关键是理解，从而能够解决问题。</p>
<p>好，回归正题。</p>
</blockquote>
<p>先看看为什么会出现乱码，出现了乱码会是哪里出现问题，应该如何排查。</p>
<p>为什么会出现乱码？</p>
<p>如果客户端用字符集A编码对字符进行编码，而服务端用字符集B对字符进行解码，最终效果就是会出现乱码。</p>
<p>例如：</p>
<p><code>我</code> --- utf8编码 ---&gt; <code>E68891</code>（十六进制）</p>
<p><code>E68891</code> --- GBK解码 ---&gt; <code>鎴?</code></p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>💡 知识插播：字符集与编码的奥秘（点击展开）</b></summary><div><div class="collapsibleContent_i85q"><p><em>看完「为什么会出现乱码？」这个问题的答案之后，不知道屏幕前的你脑袋中会不会有更多的问题冒出来了。</em></p><p><em>ps: 下面的问题跟解决我们的乱码问题没有直接关系，如果想直接看问题的解决方案，可以跳过，按需食用。</em></p><ul>
<li class="">问题一：字符集是什么</li>
<li class="">问题二：为什么要有多种不同的字符集</li>
<li class="">问题三：为什么发送方要对字符编码之后，才传给接收方，而不是直接传这个字符给接收方</li>
</ul><p><strong>回答问题一：字符集是什么？</strong></p><p>我们知道计算机只能存储0和1，那计算机是如何存储字符的呢？就是通过建立字符和二进制数的映射关系。</p><p>要建立映射关系需要确认两件事：</p><ol>
<li class="">字符范围：世界上有这么多字符，要给哪些字符建立映射关系</li>
<li class="">映射规则：打个比方，a映射为 000，b映射为001，c映射为010...</li>
</ol><p>==<em><strong>字符集就是某个字符范围的编码规则。</strong></em>==</p><p>例如今天我创建一个我自己的字符集，叫啥好呢，干脆取名为tudou字符集好了。</p><ol>
<li class="">字符范围：a、b、c、d这四个字符</li>
<li class="">映射规则：<!-- -->
<ul>
<li class="">a: 00000000</li>
<li class="">b: 00000001</li>
<li class="">c: 00000010</li>
<li class="">d: 00000011</li>
</ul>
</li>
</ol><p>如果计算机使用tudou字符集，那它底层就是这样存储字符串的，例如：</p><p>&#x27;ac&#x27; -&gt; 00000000 00000010</p><p>&#x27;bbb&#x27; -&gt; 00000001 00000001 00000001</p><p>OK，到这里，大家已经明白了字符集是什么：某个字符范围的编码规则。</p><p>那我们顺便再介绍一下常见的字符集，来加深一下对字符集的理解：</p><ul>
<li class="">
<p><code>ASCII</code>字符集</p>
<ul>
<li class="">
<p>共收录128个字符，包括空格、标点符号、<strong>数字</strong>、<strong>大小写字母</strong>和一些不可见字符。</p>
</li>
<li class="">
<p>使用1个字节来进行编码。</p>
</li>
<li class="">
<p>我们看一些字符的编码方式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;L&#x27; -&gt;  01001100（十六进制：0x4C，十进制：76）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;M&#x27; -&gt;  01001101（十六进制：0x4D，十进制：77）</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
<li class="">
<p><code>ISO 8859-1</code>字符集（别名<code>latin1</code>）</p>
<ul>
<li class="">
<p>共收录256个字符，是在<code>ASCII</code>字符集的基础上又扩充了128个西欧常用字符(包括德法两国的字母)</p>
</li>
<li class="">
<p>使用1个字节来进行编码。</p>
</li>
</ul>
</li>
<li class="">
<p><code>utf8</code>字符集</p>
<ul>
<li class="">
<p>收录地球上能想到的所有字符，而且还在不断扩充。</p>
</li>
<li class="">
<p>这种字符集兼容<code>ASCII</code>字符集，采用变长编码方式，编码一个字符需要使用1～4个字节。</p>
</li>
<li class="">
<p>准确的说，utf8只是Unicode字符集的一种编码方案，Unicode字符集可以采用utf8、utf16、utf32这几种编码方案，utf8使用1～4个字节编码一个字符，utf16使用2个或4个字节编码一个字符，utf32使用4个字节编码一个字符。</p>
</li>
<li class="">
<p>由于常用的字符使用1-3个字节表示就足够了，MySQL为了性能考虑，定义了utfmb3和utfmb4：</p>
<ul>
<li class="">
<p><code>utf8mb3</code>：阉割过的<code>utf8</code>字符集，只使用1～3个字节表示字符。</p>
</li>
<li class="">
<p><code>utf8mb4</code>：正宗的<code>utf8</code>字符集，使用1～4个字节表示字符。</p>
<p>在MySQL中<code>utf8</code>是<code>utf8mb3</code>的别名。（现在MySQL已经趋向于推荐大家使用utf8mb4）</p>
</li>
</ul>
</li>
</ul>
</li>
</ul><p><strong>回答问题二：为什么要有多种不同的字符集？</strong></p><p>为什么要有多种不同的字符集，用一种统一的字符集不就好了？</p><p>一开始计算机是由美国人发明的，由于英语只需要表示26个英文字母以及数字等等，字符比较少，因此美国人用ASCII编码，每个字符用一个字节即可表示。</p><p>后来美国以外的其他国家计算机也发展起来了，为了能够表示自己的语言，中国推出了<code>GB2312</code>字符集，在ASCII字符集的基础上收录了汉字等字符。西欧推出了latin1，在ASCII字符集的基础上收录了128个西欧常用字符(包括德法两国的字母)。</p><p>所以其实有多种字符集其实是历史遗留原因。</p><p>现在大部分应用使用的都是UTF-8字符集，因为UTF-8兼容全球语言。</p><p><strong>回答问题三：为什么发送方要对字符编码之后，才传给接收方，而不是直接传这个字符给接收方？</strong></p><p>因为数据是通过电信号传播的，电信号只有两种0和1，我们必须要将字符转化为01编码，才能够通过电信号传播给对方。</p><p>字符 --&gt;  二进制 这个过程就是所谓的编码过程</p><p>二进制 --&gt;  字符 这个过程就是所谓的解码过程</p><p>为了保证接收方能够正确从二进制转化为字符，接收方和发送方使用的字符集必须要一致。</p><p>如果不一致，就会出现乱码问题。</p></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="四乱码排错实战">四、乱码排错实战<a href="#四乱码排错实战" class="hash-link" aria-label="四、乱码排错实战的直接链接" title="四、乱码排错实战的直接链接" translate="no">​</a></h2>
<p>既然理论上乱码源于「编解码字符集不一致」，那我们就来验证一下，在我的 MySQL 环境里，这个「不一致」到底发生在哪个环节。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-关键知识">4.1 关键知识<a href="#41-关键知识" class="hash-link" aria-label="4.1 关键知识的直接链接" title="4.1 关键知识的直接链接" translate="no">​</a></h3>
<p>在这之前，还需要介绍一下MySQL客户端和服务端交互的过程中字符集是如何变化的，这个过程涉及下面三个系统变量：</p>
<table><thead><tr><th>系统变量</th><th>描述</th></tr></thead><tbody><tr><td><code>character_set_client</code></td><td>服务器解码客户端发来的请求时使用的字符集</td></tr><tr><td><code>character_set_connection</code></td><td>服务器处理请求时会把请求字符串从<code>character_set_client</code>转为<code>character_set_connection</code></td></tr><tr><td><code>character_set_results</code></td><td>服务器向客户端返回数据时使用的字符集</td></tr></tbody></table>
<p>以客户端发送<code>SELECT * FROM t WHERE s = &#x27;我&#x27;;</code>请求为例介绍</p>
<ol>
<li class="">
<p>客户端将整个请求字符串进行编码，发送给服务端</p>
<p>客户端使用的字符集和客户端OS相关，如下：</p>
<ul>
<li class="">类<code>Unix</code>系统使用的是<code>utf8</code></li>
<li class=""><code>Windows</code>使用的是<code>gbk</code></li>
</ul>
</li>
<li class="">
<p>服务端接收到二进制形式的请求，它会认为这个二进制字节采用的是character_set_client对应的字符集编码，因此服务端会以相同的字符集进行解码。</p>
<p>然后服务端会以character_set_connection字符集进行编码</p>
</li>
<li class="">
<p>如果s列使用的字符集和character_set_connection字符集不一致，则还需要转换为s列使用的字符集</p>
</li>
<li class="">
<p>执行查询操作</p>
</li>
<li class="">
<p>查询到结果之后，会将结果从s列使用的字符集解码，用character_set_results字符集编码发送给客户端</p>
</li>
<li class="">
<p>最后客户端再对结果进行解码</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20251227205525372" src="/my-blog/assets/images/image-20251227205525372-175609310442ded8feb72742dd297453.png" width="1542" height="732" class="img_ev3q"></p>
<p>99%的情况下，这三个系统变量都是完全一样的值，只有及其少数的情况下是不一样的。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-盘点案发现场的配置">4.2 盘点“案发现场”的配置<a href="#42-盘点案发现场的配置" class="hash-link" aria-label="4.2 盘点“案发现场”的配置的直接链接" title="4.2 盘点“案发现场”的配置的直接链接" translate="no">​</a></h3>
<p>我们现在已经知道了MySQL客户端和服务端交互的过程中字符集是如何变化的，那我们可以看看客户端和服务端使用的字符集是否不同，从而导致的乱码。</p>
<p>我们先来“对账”，看看客户端和服务端分别在用什么：</p>
<ul>
<li class="">
<p>服务端</p>
<p>使用<code>SHOW VARIABLES LIKE &#x27;character_set_%;&#x27;</code>命令，看一下MySQL Server这三个系统变量的值：</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image-20260209200458701" src="/my-blog/assets/images/image-20260209200458701-7538dd74ad9b1aef88a022113b4e2d1f.png" width="854" height="422" class="img_ev3q"></p>
<p>​	可以看到，都是latin1。</p>
<ul>
<li class="">
<p>客户端</p>
<p>我的电脑默认使用的是UTF-8字符集，在macOS中，你可以通过locale命令来看使用的字符集。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(base) tudouPotatoo@tudouPotatoodeMacBook-Air ~ % locale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LANG=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_COLLATE=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_CTYPE=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_MESSAGES=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_MONETARY=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_NUMERIC=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_TIME=&quot;zh_CN.UTF-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LC_ALL=</span><br></span></code></pre></div></div>
<p>也可以通过打开terminal，点击终端--&gt;设置--&gt;描述文件--&gt;高级 拉到最下面，看到多语言环境部分的文本编码，也可以看到使用的编码方式。</p>
<p><img decoding="async" loading="lazy" alt="image-20260209201549406" src="/my-blog/assets/images/image-20260209201549406-a3373d8b42f16ec8ce6bdd547a7eed9f.png" width="1334" height="1240" class="img_ev3q"></p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="43-深度还原一条数据的受难记">4.3 深度还原：一条数据的“受难记”<a href="#43-深度还原一条数据的受难记" class="hash-link" aria-label="4.3 深度还原：一条数据的“受难记”的直接链接" title="4.3 深度还原：一条数据的“受难记”的直接链接" translate="no">​</a></h3>
<p>**我们分析一下插入一条数据，整个编码解码流程。**我们以插入 <code>real_name</code> 为 <strong>“万重山”</strong> 的这条数据为例，看看它在传输过程中是如何被一步步搞“糊”的：</p>
<p>插入数据的DML命令是下面这样的</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">t_passenger_15</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">username</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">real_name</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id_type</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id_card</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">discount_type</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">phone</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">create_date</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">verify_status</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">update_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">del_flag</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1683029289099362304</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;万重山&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;7XT4j1iCfK8DeSiZeJs1M00oDOG/KxdBXKR34j5YLZc=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;MZObk+5TeYPLHtP2A6+aiw==&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2023-07-23 16:20:26&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2023-07-23 16:20:26&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2023-07-23 16:20:26&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre></div></div>
<p><em>在分析这段 SQL 语句时，我发现除了‘万重山’这三个中文字符外，其余内容（如 <code>INSERT</code>、<code>VALUES</code>、数字和标点）均属于 <strong>ASCII 字符集</strong>。由于现代主流字符集（如 UTF-8、GBK、Latin1）在设计上都<strong>向下兼容 ASCII</strong>（即对于前 128个字符，它们的编码字节完全相同），这意味着即便编码和解码的字符集不匹配，这些英文字符也不会出现乱码。因此，我们可以暂时忽略这些‘安全’的 ASCII 字符，将目光聚焦在受灾区——‘万重山’这三个中文字符上，它们才是揭开编解码错位真相的关键。</em></p>
<p>第一阶段：客户端发出请求</p>
<p>我的Mac终端在给mysql server发送命令之前，会通过utf8给命令进行编码。</p>
<p>“万重山”三个字就变成了下面这样</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">E4 B8 </span><span class="token number" style="color:#36acaa">87</span><span class="token plain"> E9 </span><span class="token number" style="color:#36acaa">87</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">D E5 B1 B1</span><br></span></code></pre></div></div>
<p>第二阶段：服务端接收与解码</p>
<p>mysql server接收到之后，它认为客户端使用的是latin1（character_set_client系统变量）来编码，因此也用latin1解码，解码之后得到下面的内容。这些实际上都是latin1字符集的西欧字符，但我们看不懂，就称为乱码。</p>
<p><code>ä¸éå±±</code></p>
<p>第三阶段：中间转换与入库</p>
<p>服务器将这些西欧字符再用latin1（character_set_connection系统变量）来编码，由于real_name列使用的是utf8mb4字符集，因此从latin1字符集转为utf8mb4字符集。即先用latin1解码，再用utf8mb4编码，然后存入DB中。</p>
<p><img decoding="async" loading="lazy" alt="image-20260213220117832" src="/my-blog/assets/images/image-20260213220117832-1e5ff73ee6f9bb32397c88869b455317.png" width="2168" height="534" class="img_ev3q"></p>
<p>总结一下，<strong>DB存储的是<code>ä¸éå±±</code>这些乱码的utf8mb4形式。数据库存的就是乱码，数据库存的就是脏数据！</strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="44-数据读取的过程">4.4 数据读取的过程<a href="#44-数据读取的过程" class="hash-link" aria-label="4.4 数据读取的过程的直接链接" title="4.4 数据读取的过程的直接链接" translate="no">​</a></h3>
<p><strong>那在DBeaver查询的过程是咋样的？</strong></p>
<p>其实我们打开下面这个页面，它本质就是执行了<code>SELECT * FROM t_passenger_15;</code>这个命令，我们继续分析一下<code>SELECT * FROM t_passenger_15</code>这个sql语句运行过程。</p>
<p><img decoding="async" loading="lazy" alt="image-20260213220349329" src="/my-blog/assets/images/image-20260213220349329-f77b7dbc9a9244edd7574f8c2f463c1a.png" width="1652" height="336" class="img_ev3q"></p>
<p>我们用DBeaver连接数据库的时候，它其实会做这样一件事情：</p>
<p>右键这个数据库连接</p>
<p><img decoding="async" loading="lazy" alt="image-20260213221036925" src="/my-blog/assets/images/image-20260213221036925-db110c4fb928b3dc1f9c53221a0abb1d.png" width="982" height="380" class="img_ev3q"></p>
<p>找到characterEncoding，这指定了DBeaver使用的字符集。</p>
<p><img decoding="async" loading="lazy" alt="image-20260213221146187" src="/my-blog/assets/images/image-20260213221146187-44553e071a46f935d5fd301412017a58.png" width="1420" height="1074" class="img_ev3q"></p>
<p><strong>DBeaver在（通过 JDBC 驱动）连接建立时，会自动执行<code>SET NAMES utf8mb4</code></strong>（在DBeaver，utf-8 = utf8mb4）</p>
<p>那相当于<code>character_set_client</code>、<code>character_set_connection</code>、<code>character_set_result</code>全都被统一设为了 <code>utf8mb4</code>。</p>
<p><strong>数据读取的链路分析：</strong></p>
<ol>
<li class="">
<p>服务端取数：MySQL Server 从磁盘读取 real_name 列的内容。由于该列已经是 utf8mb4 编码，且要求的 character_set_results 也是 utf8mb4，服务器不会进行任何转换，直接将字节流原样返回。</p>
</li>
<li class="">
<p>客户端解码：DBeaver 接收到这串原始字节流，按照既定的 utf8mb4 规则进行解码。</p>
</li>
<li class="">
<p>最终呈现：因为数据库里存的原本就是那串“西欧乱码字节”，DBeaver 忠实地将其解了出来。所以，你在屏幕上看到了诸如<code>ä¸éå±±</code>的乱码。</p>
</li>
</ol>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><b>趣味发现：CLI 里的“负负得正”魔法</b></summary><div><div class="collapsibleContent_i85q"><p>在分析完 DBeaver 的乱码后，我很好奇：如果不用图形化工具，直接在终端交互窗口（即 <code>mysql -uroot -p</code> 进入的 CLI）执行 <code>SELECT</code>，会发生什么？</p><p>令人意外的结果出现了：<strong>在终端里，中文居然显示正常了！</strong></p><p>明明数据库里存的是乱码，为什么客户端反而能读到正确的字符？经过推导，我发现这其实是一个**“负负得正”**的巧合。</p><p>我们要先记住，此时数据库里存的已经是经过“错误解码”后的西欧字符乱码了。</p><p><strong>CLI读取时的链路转换</strong></p><p>当我们执行查询时，MySQL CLI 经历了一个极其曲折的变换过程：</p><p><strong>取数</strong>：从磁盘读出 utf8mb4 格式的“脏字节”。</p><p><strong>解码</strong>：服务端由于 character_set_results 是 latin1，它会尝试用 latin1 对这些字节进行编码。</p><p><strong>传输</strong>：将编码后的字节流发送给客户端。</p><p><strong>终端呈现</strong>：我的 macOS 终端本身是 UTF-8。当它收到字节流后，会尝试用 UTF-8 进行最后一次解码。</p><p>如果我们剥离掉中间繁杂的步骤，整个生命周期就像这样：</p><p>万重山 → (UTF-8 编码) → (Latin1 解码) → [ 存于 DB 的脏数据 ] &gt; → (Latin1 编码) → (终端 UTF-8 解码) → 万重山</p><p>真相大白：正是因为入库时多了一次错误的 Latin1 解码，而读取显示时又恰好经过了一次 Latin1 编码还原和 UTF-8 解码，这两层错误竟然完美抵消了！</p><p>也就是说，如果用mysql交互式命令窗口，执行<code>SELECT * FROM t_passenger_15;</code></p><p>能够读到正确的中文</p><p><img decoding="async" loading="lazy" alt="image-20260215213612452" src="/my-blog/assets/images/image-20260215213612452-7bcdfa8c7129d80303d5fd822c8975aa.png" width="1542" height="408" class="img_ev3q"></p><p>虽然数据库存的是乱码，客户端依然能读到正确的字符，很有意思哈哈哈</p><p>虽然这种“负负得正”让中文在终端里看起来是正常的，但这其实掩盖了数据库中数据早已损坏的事实。一旦你换一个客户端环境（比如换到 Windows 的 GBK 环境）来读数据库的数据，就不会生效。</p></div></div></details>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="45-拨乱反正彻底告别乱码">4.5 拨乱反正：彻底告别乱码<a href="#45-拨乱反正彻底告别乱码" class="hash-link" aria-label="4.5 拨乱反正：彻底告别乱码的直接链接" title="4.5 拨乱反正：彻底告别乱码的直接链接" translate="no">​</a></h3>
<p><strong>我们现在知道了问题产生的原因：mysql client用utf8编码，mysql server用latin1解码，得到了乱码，导致存在数据库中的就是乱码。</strong></p>
<p>那如何解决这个问题呢？答案：让mysql client和mysql server使用的字符集保持一致。</p>
<p>现在macOS默认就是使用utf8（在macOS，utf-8 = utf8mb4）编码方式，那我们可以让mysql server也使用utf8mb4字符集，有很多种做法：</p>
<ul>
<li class="">
<p>做法1：改变SESSION范围（character_set_client、character_set_connection、character_set_result）这三个系统变量的值</p>
<blockquote>
<p>这种做法仅对当前连接生效</p>
</blockquote>
<p>下面四种方式效果完全一致。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> NAMES 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>或</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>或</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SESSION</span><span class="token plain"> character_set_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SESSION</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SESSION</span><span class="token plain"> character_set_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>或</p>
<p>连接数据库的时候加上下面这个参数</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--default-character-set=utf8mb4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* mysql -u root -proot --default-character-set=utf8mb4 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 当你使用 --default-character-set=utf8mb4 启动 MySQL 客户端并成功登录后，</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">	 客户端会自动发送一条 SET NAMES utf8mb4 给服务器。 */</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>做法2：改变GLOBAL范围（character_set_client、character_set_connection、character_set_result）这三个系统变量的值</p>
<blockquote>
<p>这种做法仅对后续新创建的连接生效，不影响已有的连接</p>
</blockquote>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GLOBAL</span><span class="token plain"> character_set_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GLOBAL</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GLOBAL</span><span class="token plain"> character_set_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>做法3：永久改变</p>
<p>上面的做法1、2都是临时性的，如果要修改默认配置，而不是每次都执行这些命令，可以直接修改mysql的配置文件<code>my.cnf</code> (macOS/Linux) 或 <code>my.ini</code> (Windows)：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 影响 mysql 命令行客户端</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 所有连接 MySQL 的本地程序（比如 mysql 命令行、mysqldump 备份工具、mysqlcheck 修复工具）都会先读取这里的设置。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 作用：和服务端连接成功就执行SET NAMES utf8mb4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 既是“声明”，也是“指令”。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 声明层面：就是和mysql server建立连接的时候告诉mysql server，我发送过来的数据都是utf8mb4编码的，你也用这个字符集来处理吧。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 指令层面：当client从终端接收到数据之后，如果发现数据不是utf8mb4编码，会先转成utf8mb4编码，然后再发给server。例如如果终端使用的是ascii编码，则client接收到之后会先转化为utf8mb4编码。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 影响 mysql 客户端默认行为</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 专指 mysql 交互式命令行窗口（就是在终端输入 mysql -u root -p 进去的那个）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 它继承并细化了 [client]。如果这里不设，它会用 [client] 的。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 专门写出来是为了方便给命令行窗口做个性化（比如定义命令提示符格式、开启自动补全等）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 影响服务器端默认行为</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 指定服务器默认使用的字符集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 当你执行 CREATE DATABASE 或 CREATE TABLE 而没有手动指定字符集时，MySQL 就会自动使用这个配置的值作为默认值。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 指定服务器默认使用的排序规则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collation</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4_unicode_ci</span><br></span></code></pre></div></div>
<p>三个地方都指定，保证整个链路上的编码方式是一致的，就不会出现乱码问题。</p>
</li>
</ul>
<p>**验证生效：**修改了之后，可以使用<code>SHOW VARIABLES LIKE &#x27;character_set_%&#x27;;</code>这个命令校验一下是否生效。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="46-实战演练验证修复方案">4.6 实战演练：验证修复方案<a href="#46-实战演练验证修复方案" class="hash-link" aria-label="4.6 实战演练：验证修复方案的直接链接" title="4.6 实战演练：验证修复方案的直接链接" translate="no">​</a></h3>
<p>上面都是理论，我们直接来实践一下，按上述的方法是不是真的可以生效。</p>
<p><strong>“病况”：</strong></p>
<ul>
<li class="">
<p>现在数据库中存的中文在DBeaver中显示的都是乱码</p>
<p><img decoding="async" loading="lazy" alt="image-20260209163556048" src="/my-blog/assets/images/image-20260209163556048-b9f533d9eaab27ea8dcbb999a7618842.png" width="1572" height="350" class="img_ev3q"></p>
</li>
<li class="">
<p>操作系统macOS，默认使用utf8mb4字符集</p>
</li>
<li class="">
<p>数据库的character_set_client、character_set_connection、character_set_results都是latin1。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Database</span><span class="token plain"> changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> VARIABLES </span><span class="token operator" style="color:#393A34">LIKE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;character_set_%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Variable_name            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain">                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_client     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_database   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_filesystem </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">binary</span><span class="token plain">                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_results    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_server     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_system     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_sets_dir       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">share</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">charsets</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ul>
<p>我们用4.5讨论做法实践一下</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="做法1方式1">做法1方式1<a href="#做法1方式1" class="hash-link" aria-label="做法1方式1的直接链接" title="做法1方式1的直接链接" translate="no">​</a></h4>
<p>改变SESSION范围（character_set_client、character_set_connection、character_set_result）这三个系统变量的值</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> NAMES 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ol>
<li class="">drop掉12306这个数据库</li>
<li class="">执行<code>SET NAMES utf8mb4;</code></li>
<li class="">创建12306这个数据库</li>
<li class="">执行<code>source tmp/db.sql;</code>和<code>source tmp/data.sql;</code></li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># drop掉12306这个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.19</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行`SET NAMES utf8mb4;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> NAMES utf8mb4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建12306这个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!32312 IF NOT EXISTS*/</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 验证系统变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> VARIABLES </span><span class="token operator" style="color:#393A34">LIKE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;character_set_%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Variable_name            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain">                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_client     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_database   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_filesystem </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">binary</span><span class="token plain">                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_results    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_server     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_system     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_sets_dir       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">share</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">charsets</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12306</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Database</span><span class="token plain"> changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行DDL.sql（这里我提前将.sql文件cp进docker容器）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行DML.sql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">480</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">480</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>我们用DBeaver查看数据，现在可以正常展示中文。</p>
<p><img decoding="async" loading="lazy" alt="image-20260214154044827" src="/my-blog/assets/images/image-20260214154044827-b4d02862cbc8d4b70fc28caed532572b.png" width="1702" height="336" class="img_ev3q"></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="做法1方式2">做法1方式2<a href="#做法1方式2" class="hash-link" aria-label="做法1方式2的直接链接" title="做法1方式2的直接链接" translate="no">​</a></h4>
<p>我们试一下用这种方式</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 字符集名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ol>
<li class="">
<p>drop掉12306这个数据库</p>
</li>
<li class="">
<p>新打开一个terminal，用<code>mysql -u root -proot</code>这个命令连接mysql server</p>
</li>
<li class="">
<p>执行下面这三个命令</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> character_set_results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>创建12306这个数据库</p>
</li>
<li class="">
<p>执行<code>source tmp/db.sql;</code>和<code>source tmp/data.sql;</code></p>
</li>
<li class="">
<p>在DBeaver查看表数据---&gt;中文正常展示</p>
<p><img decoding="async" loading="lazy" alt="image-20260214155721666" src="/my-blog/assets/images/image-20260214155721666-bd9a8227eb73253b40634130295bddbf.png" width="1332" height="334" class="img_ev3q"></p>
</li>
<li class="">
<p>新开一个terminal，用<code>mysql -u root -proot</code>这个命令连接mysql server</p>
</li>
<li class="">
<p>创建12307表</p>
</li>
<li class="">
<p>执行<code>source tmp/db.sql;</code>和<code>source tmp/data.sql;</code></p>
</li>
<li class="">
<p>在DBeaver查看表数据---&gt;中文显示乱码</p>
<p><img decoding="async" loading="lazy" alt="image-20260214160028853" src="/my-blog/assets/images/image-20260214160028853-78d11cad14f865332806813c8f57061e.png" width="1080" height="276" class="img_ev3q"></p>
</li>
<li class="">
<p><strong>可以看出这三个命令确实只是SESSION级别生效</strong></p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="做法1方式3">做法1方式3<a href="#做法1方式3" class="hash-link" aria-label="做法1方式3的直接链接" title="做法1方式3的直接链接" translate="no">​</a></h4>
<p>做法1还有一种方式，我们也来试试，<code>mysql -u root -proot --default-character-set=utf8mb4</code> 用这个命令来连接mysql server。</p>
<ol>
<li class="">drop掉12306这个数据库</li>
<li class="">新打开一个terminal，用<code>mysql -u root -proot --default-character-set=utf8mb4</code>这个命令连接mysql server</li>
<li class="">创建12306这个数据库</li>
<li class="">执行<code>source tmp/db.sql;</code>和<code>source tmp/data.sql;</code></li>
</ol>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># drop掉12306这个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.18</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 新打开一个terminal，用`mysql -u root -proot --default-character-set=utf8mb4`这个命令连接mysql server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tudouPotatoo</span><span class="token variable" style="color:#36acaa">@tudouPotatoodeMacBook</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Air </span><span class="token operator" style="color:#393A34">~</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docker </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">it mysql mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u root </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">proot </span><span class="token comment" style="color:#999988;font-style:italic">--default-character-set=utf8mb4 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Warning</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Using</span><span class="token plain"> a password </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> the command line interface can be insecure</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> the MySQL monitor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  Commands </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> \g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your MySQL connection id </span><span class="token operator" style="color:#393A34">is</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server version: </span><span class="token number" style="color:#36acaa">5.7</span><span class="token number" style="color:#36acaa">.36</span><span class="token plain"> MySQL Community Server </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GPL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2021</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Oracle </span><span class="token operator" style="color:#393A34">and</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> its affiliates</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Oracle </span><span class="token operator" style="color:#393A34">is</span><span class="token plain"> a registered trademark </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> Oracle Corporation </span><span class="token operator" style="color:#393A34">and</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> its</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">affiliates</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> Other names may be trademarks </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> their respective</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">owners</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Type</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;help;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">or</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\h&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> help</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Type</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\c&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> clear the </span><span class="token keyword" style="color:#00009f">current</span><span class="token plain"> input statement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建12306这个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!32312 IF NOT EXISTS*/</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12306</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Database</span><span class="token plain"> changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行`source tmp/db.sql;`和`source tmp/data.sql;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">480</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">480</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>完毕，用DBeaver查看数据依然能够正常显示中文</p>
<p><img decoding="async" loading="lazy" alt="image-20260214154826767" src="/my-blog/assets/images/image-20260214154826767-0ef2f2481e34e21d0a4ca56e7ec23533.png" width="1492" height="348" class="img_ev3q"></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="做法2">做法2<a href="#做法2" class="hash-link" aria-label="做法2的直接链接" title="做法2的直接链接" translate="no">​</a></h4>
<p>做法2我们就不进行演示了，和做法1是非常类似的。</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="做法3">做法3<a href="#做法3" class="hash-link" aria-label="做法3的直接链接" title="做法3的直接链接" translate="no">​</a></h4>
<p>接下来实践一下做法3，修改mysql的配置文件。</p>
<p>首先我们先看一下原本的mysql配置文件长啥样。</p>
<ol>
<li class="">
<p>进入docker容器的交互式终端</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tudouPotatoo</span><span class="token variable" style="color:#36acaa">@tudouPotatoodeMacBook</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Air </span><span class="token operator" style="color:#393A34">~</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docker </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">it mysql bash</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>一般来说，MySQL配置文件位于<code>/etc/mysql/my.cnf</code>这个位置，我们cat一下</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tudouPotatoo</span><span class="token variable" style="color:#36acaa">@tudouPotatoodeMacBook</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Air </span><span class="token operator" style="color:#393A34">~</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docker </span><span class="token keyword" style="color:#00009f">exec</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">it mysql bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root</span><span class="token variable" style="color:#36acaa">@5737b5b11c07</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">/</span><span class="token comment" style="color:#999988;font-style:italic"># cat /etc/mysql/my.cnf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Copyright (c) 2016, 2021, Oracle and/or its affiliates.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This program is free software; you can redistribute it and/or modify</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># it under the terms of the GNU General Public License, version 2.0,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># as published by the Free Software Foundation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This program is also distributed with certain software (including</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># but not limited to OpenSSL) that is licensed under separate terms,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># as designated in a particular file or component or in included license</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># documentation.  The authors of MySQL hereby grant you an additional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># permission to link the program and your derivative works with the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># separately licensed software that they have included with MySQL.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This program is distributed in the hope that it will be useful,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># GNU General Public License, version 2.0, for more details.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You should have received a copy of the GNU General Public License</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># along with this program; if not, write to the Free Software</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">!</span><span class="token plain">includedir </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">etc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">d</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">!</span><span class="token plain">includedir </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">etc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">d</span><span class="token operator" style="color:#393A34">/</span><br></span></code></pre></div></div>
<p>看my.cnf配置文件可以看到，这里没有任何的配置信息。</p>
<p>最后的<code>!includedir /etc/mysql/conf.d/</code> 和<code>!includedir /etc/mysql/mysql.conf.d/</code>这两行含义为：请去这两个文件夹里寻找所有以 <code>.cnf</code> 结尾的文件，并把它们的内容全部加载进来。</p>
<p>所以真正的配置信息在这两个路径下</p>
</li>
<li class="">
<p>查看这两个路径下的信息</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/# cd /etc/mysql/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/conf.d# ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker.cnf  mysql.cnf  mysqldump.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/conf.d# cat mysql.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysql]</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/conf.d# cd /etc/mysql/mysql.conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/mysql.conf.d# ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysqld.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/mysql.conf.d# cat mysqld.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copyright (c) 2014, 2021, Oracle and/or its affiliates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This program is free software; you can redistribute it and/or modify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># it under the terms of the GNU General Public License, version 2.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># as published by the Free Software Foundation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This program is also distributed with certain software (including</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># but not limited to OpenSSL) that is licensed under separate terms,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># as designated in a particular file or component or in included license</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># documentation.  The authors of MySQL hereby grant you an additional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># permission to link the program and your derivative works with the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># separately licensed software that they have included with MySQL.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This program is distributed in the hope that it will be useful,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GNU General Public License, version 2.0, for more details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># You should have received a copy of the GNU General Public License</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># along with this program; if not, write to the Free Software</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The MySQL  Server configuration file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># For explanations see</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid-file	= /var/run/mysqld/mysqld.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socket		= /var/run/mysqld/mysqld.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir		= /var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#log-error	= /var/log/mysql/error.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># By default we only accept connections from localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#bind-address	= 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">symbolic-links=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/mysql.conf.d# </span><br></span></code></pre></div></div>
<p>汇总一下，配置信息就是下面这样：</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mysql]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid-file	= /var/run/mysqld/mysqld.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socket		= /var/run/mysqld/mysqld.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir		= /var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#log-error	= /var/log/mysql/error.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># By default we only accept connections from localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#bind-address	= 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">symbolic-links=0</span><br></span></code></pre></div></div>
<p>所以实际上，是没有配置任何和字符集相关的信息的。</p>
<p>没有配置，就会使用默认值。</p>
<ul>
<li class="">
<p><strong>MySQL 5.7 及以下版本</strong>：默认是 <code>latin1</code>。如果存中文，必乱码。</p>
</li>
<li class="">
<p><strong>MySQL 8.0 及以上版本</strong>：默认是 <code>utf8mb4</code>。这是现代标准，支持中文和 Emoji，通常不需要额外配置。</p>
</li>
</ul>
<p>我们这里使用的MySQL版本正好是5.7版本，因此就是默认使用<code>latin1</code>字符集。</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/mysql.conf.d# mysql --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql  Ver 14.14 Distrib 5.7.36, for Linux (x86_64) using  EditLine wrapper</span><br></span></code></pre></div></div>
<p>也就解释了为什么一开始执行<code>SHOW VARIABLES LIKE &#x27;character_set_%&#x27;;</code>，<code>character_set_client</code>、<code>character_set_connection</code>和<code>character_set_results</code>这三个系统变量的值是latin1。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> VARIABLES </span><span class="token operator" style="color:#393A34">LIKE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;character_set_%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Variable_name            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Value</span><span class="token plain">                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_client     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_connection </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_database   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8mb4                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_filesystem </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">binary</span><span class="token plain">                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_results    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_server     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> latin1                     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_set_system     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> utf8                       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> character_sets_dir       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">share</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">charsets</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token comment" style="color:#999988;font-style:italic">--------------------------+----------------------------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ol>
<p>我们现在已经看到了原本的配置文件是长啥样，我们希望改成这样：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">character</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">set</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collation</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> utf8mb4_unicode_ci</span><br></span></code></pre></div></div>
<p><strong>做法如下：</strong></p>
<ol>
<li class="">
<p>在宿主机创建一个<code>my-custom.cnf</code>文件</p>
<p>内容为</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[client]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default-character-set = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysql]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default-character-set = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">character-set-server = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collation-server = utf8mb4_unicode_ci</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>将文件复制到docker mysql里面</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker cp /Users/tudouPotatoo/Developer/pre-blog/file/my-custom.cnf 5737b5b11c07:/etc/mysql/conf.d/</span><br></span></code></pre></div></div>
<p>为啥是复制到/etc/mysql/conf.d/这个路径，就是因为我们<code>cat /etc/mysql/my.cnf</code>配置文件看到mysql是从<code>/etc/mysql/conf.d/</code>这个路径加载<code>.cnf</code>类型的文件作为配置。</p>
</li>
<li class="">
<p>让配置生效，restart一下容器</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker restart mysql</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>可以检查一下是否复制进去了</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(base) tudouPotatoo@tudouPotatoodeMacBook-Air ~ % docker exec -it mysql bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/# cd /etc/mysql/conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/conf.d# ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker.cnf  my-custom.cnf  mysql.cnf  mysqldump.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5737b5b11c07:/etc/mysql/conf.d# cat my-custom.cnf </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[client]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default-character-set = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysql]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default-character-set = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">character-set-server = utf8mb4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collation-server = utf8mb4_unicode_ci</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>进入mysql交互页，检查配置是否生效</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(base) tudouPotatoo@tudouPotatoodeMacBook-Air ~ % docker exec -it mysql mysql -uroot -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your MySQL connection id is 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server version: 5.7.36 MySQL Community Server (GPL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Oracle is a registered trademark of Oracle Corporation and/or its</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">affiliates. Other names may be trademarks of their respective</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">owners.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show variables like &quot;char%&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name            | Value                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_client     | utf8mb4                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_connection | utf8mb4                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_database   | utf8mb4                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_filesystem | binary                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_results    | utf8mb4                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_server     | utf8mb4                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_set_system     | utf8                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 rows in set (0.02 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>可以看到<code>character_set_client</code>、<code>character_set_connection</code>、<code>character_set_results</code>这些配置的值都是utf8mb4。生效了！</p>
</li>
<li class="">
<p>新开一个terminal，把之前测试的12306、12307数据库都drop掉，重新建库，重新执行<code>.sql</code>文件</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.20</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12307</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.18</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!32312 IF NOT EXISTS*/</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">12306</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12306</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Database</span><span class="token plain"> changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> source tmp</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">480</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Records: </span><span class="token number" style="color:#36acaa">480</span><span class="token plain">  Duplicates: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Warnings</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
</li>
<li class="">
<p>中文能够正确显示，成功！</p>
<p><img decoding="async" loading="lazy" alt="image-20260214171817063" src="/my-blog/assets/images/image-20260214171817063-5bac42aedd9322cd914cc6efc2434504.png" width="1086" height="324" class="img_ev3q"></p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="五总结">五、总结<a href="#五总结" class="hash-link" aria-label="五、总结的直接链接" title="五、总结的直接链接" translate="no">​</a></h2>
<p>上面讨论了很多很多：</p>
<ol>
<li class="">讨论了字符集是什么</li>
<li class="">讨论了为什么要有多种字符集</li>
<li class="">讨论了为什么发送方要对字符编码之后，才传给接收方，而不是直接传这个字符给接收方</li>
<li class="">讨论了为什么会出现乱码</li>
<li class="">讨论了MySQL客户端和服务端交互的过程中字符集是如何变化的</li>
<li class="">讨论了如何修改MySQL使用的字符集（SESSION范围、GLOBAL范围、永久改变）</li>
<li class="">...</li>
</ol>
<p>回顾这次折腾的经历，我们不仅解决了一个报错，更完整梳理了 MySQL 字符集的底层逻辑：</p>
<ul>
<li class=""><strong>理清了本质</strong>：字符集是某个字符范围的编码规则，乱码的根源永远是<strong>编解码格式的不对称</strong>。</li>
<li class=""><strong>透视了链路</strong>：深入拆解了 MySQL 交互中的“三剑客”（<code>client</code>、<code>connection</code>、<code>results</code>），明白了数据如何从客户端的字节流变成服务器的存储。</li>
<li class=""><strong>掌握了手段</strong>：对比了从 Session 临时修复到 <code>my.cnf</code> 永久配置的不同方案，学会了如何从根本上解决乱码问题。</li>
</ul>
<p><em><strong>其实要保证不会出现乱码，最简单粗暴的方式就是：</strong></em></p>
<ol>
<li class=""><strong>在整个MySQL Client-MySQL Server交互的链路上，都使用同一种字符集，这样就能保证编码和解码的方式是完全一致的。</strong></li>
<li class=""><strong>使用utf8mb4字符集，因为这种字符集包含世界上的所有字符，不仅包含各种语言，还包含各种emoji，使用uft8mb4字符集，能够保证兼容世界上的所有字符。</strong></li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/my-blog/blog/tags/my-sql">MySQL</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/my-blog/blog/tags/数据库">数据库</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/my-blog/blog/tags/字符集">字符集</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/my-blog/blog/tags/docker">Docker</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/mysql-encoding-mastery.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/my-blog/blog/welcome"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Welcome</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一背景" class="table-of-contents__link toc-highlight">一、背景</a></li><li><a href="#二操作复现" class="table-of-contents__link toc-highlight">二、操作复现</a></li><li><a href="#三深度探究乱码背后的真相" class="table-of-contents__link toc-highlight">三、深度探究：乱码背后的真相</a></li><li><a href="#四乱码排错实战" class="table-of-contents__link toc-highlight">四、乱码排错实战</a><ul><li><a href="#41-关键知识" class="table-of-contents__link toc-highlight">4.1 关键知识</a></li><li><a href="#42-盘点案发现场的配置" class="table-of-contents__link toc-highlight">4.2 盘点“案发现场”的配置</a></li><li><a href="#43-深度还原一条数据的受难记" class="table-of-contents__link toc-highlight">4.3 深度还原：一条数据的“受难记”</a></li><li><a href="#44-数据读取的过程" class="table-of-contents__link toc-highlight">4.4 数据读取的过程</a></li><li><a href="#45-拨乱反正彻底告别乱码" class="table-of-contents__link toc-highlight">4.5 拨乱反正：彻底告别乱码</a></li><li><a href="#46-实战演练验证修复方案" class="table-of-contents__link toc-highlight">4.6 实战演练：验证修复方案</a></li></ul></li><li><a href="#五总结" class="table-of-contents__link toc-highlight">五、总结</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-blog/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>